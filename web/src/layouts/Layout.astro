---
interface Props {
  title: string;
}

const { title } = Astro.props;

// Check if user is logged in
const cfAuth = Astro.cookies.get('CF_Authorization')?.value;
const isLoggedIn = !!cfAuth;

// Encouraging messages - baseball theme + world proverbs about trying & failing
const encouragements = [
  // 野球系
  "Play ball! 今日も打席に立とう",
  "三振を恐れるな、バットを振れ",
  "ファウルも立派な粘り",
  "全打席ホームランの選手はいない",
  "次の一球に集中",
  "バッターボックスに立つだけで偉い",
  "送りバントも立派な仕事",
  "代打でも結果を出せる",
  "ベンチからでも声は届く",
  "9回裏まで試合は終わらない",
  // 日本のことわざ
  "七転び八起き",
  "石の上にも三年",
  "千里の道も一歩から",
  "雨降って地固まる",
  "失敗は成功のもと",
  "継続は力なり",
  "塵も積もれば山となる",
  "蒔かぬ種は生えぬ",
  // 世界のことわざ - ヨーロッパ
  "Petit à petit, l'oiseau fait son nid (仏: 少しずつ鳥は巣を作る)",
  "Chi non risica non rosica (伊: 危険を冒さねば何も得られない)",
  "Wer nicht wagt, der nicht gewinnt (独: 挑戦しなければ勝てない)",
  "El que no arriesga no gana (西: 冒険しない者は勝てない)",
  "Без труда не выловишь и рыбку из пруда (露: 労せずして池の魚は獲れない)",
  "Övning ger färdighet (スウェーデン: 練習が技を生む)",
  "Stap voor stap komt men ver (蘭: 一歩一歩で遠くへ行ける)",
  "Kto nie ryzykuje, ten nie pije szampana (ポーランド: 挑戦しない者にシャンパンはない)",
  "Pico a pico fai a pega o niño (ガリシア: くちばし一つで巣を作る)",
  "Cine nu riscă nu câștigă (ルーマニア: 冒険しない者は得られない)",
  // アジア
  "不怕慢，就怕站 (中: 遅れを恐れるな、止まることを恐れよ)",
  "천 리 길도 한 걸음부터 (韓: 千里の道も一歩から)",
  "ช้าๆ ได้พร้าเล่มงาม (タイ: ゆっくりやれば美しい鉈が得られる)",
  "Có công mài sắt, có ngày nên kim (ベトナム: 鉄を研げばいつか針になる)",
  "Sedikit-sedikit, lama-lama menjadi bukit (インドネシア: 少しずつで山になる)",
  "अभ्यास से सिद्धि होती है (ヒンディー: 練習で達成できる)",
  "هر که طاووس خواهد جور هندوستان کشد (ペルシャ: 孔雀が欲しければインドの苦労を)",
  "Damlaya damlaya göl olur (トルコ: 一滴一滴で湖になる)",
  "Ağac meyvəsi ilə tanınar (アゼルバイジャン: 木は実で知られる)",
  "Хүн болох багаасаа (モンゴル: 人は若いうちから)",
  // アフリカ
  "Haraka haraka haina baraka (スワヒリ: 急ぎすぎると祝福がない)",
  "Kidole kimoja hakivunji chawa (スワヒリ: 一本の指ではシラミも潰せない)",
  "Mbio za sakafuni huishia ukingoni (スワヒリ: 台所を走れば縁で終わる)",
  "Nnukwu osisi anaghi epu n'otu ụbọchị (イボ: 大きな木は一日では育たない)",
  "Dɛn dɛn fɔ kech di mɔnki (クリオ: 猿を捕まえるには騙さねば)",
  "Ubuntu ngumuntu ngabantu (ズールー: 人は人によって人となる)",
  "Izere vuba ntiyirirwa (ルワンダ: 急ぐ者は遅れる)",
  "N'tomikofe ko n'tomive (エウェ: 失敗しなければ学べない)",
  "Wäla yəsäw bämirkut ayattafam (アムハラ: 働く者の足は泥に沈まない)",
  // 中東・その他
  "אם אין אני לי מי לי (ヘブライ: 自分のためにならなければ誰がなる)",
  "القطرة تثقب الصخرة (アラビア: 一滴が岩を穿つ)",
  "بذر بکار تا درو کنی (ペルシャ: 蒔けば刈り取れる)",
  // 中南米・先住民
  "Caminante, no hay camino, se hace camino al andar (西: 歩く者よ、道はない、歩いて作る)",
  "In lak'ech (マヤ: あなたは私の別の自分)",
  "Ama sua, ama llulla, ama quella (ケチュア: 盗むな、嘘つくな、怠けるな)",
  // オセアニア
  "He aha te mea nui o te ao? He tangata! (マオリ: 世界で最も大切なものは？人だ！)",
  "E kore e taea te whenu kotahi ki te raranga (マオリ: 一本の藁では編めない)",
  // 英語圏
  "The only real failure is the failure to try",
  "He who never made a mistake never made anything",
  "Practice makes perfect",
  "Rome wasn't built in a day",
  "Every master was once a disaster",
  "The best time to plant a tree was 20 years ago. The second best time is now",
  "Done is better than perfect",
  "Ship it!",
];
const randomMessage = encouragements[Math.floor(Math.random() * encouragements.length)];
---

<!doctype html>
<html lang="ja" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <title>{title} | open-sen</title>
    <script is:inline>
      // Load theme from localStorage before render to prevent flash
      (function() {
        const saved = localStorage.getItem('theme');
        if (saved) {
          document.documentElement.setAttribute('data-theme', saved);
        }
      })();
    </script>
    <style is:global>
      /* ===== Theme Variables ===== */
      :root {
        /* Dark theme (Cyberpunk) - default */
        --bg-image: url('/bg-cyber.svg');
        --bg-overlay: rgba(10, 14, 20, 0.6);
        --bg-card: rgba(22, 27, 34, 0.5);
        --bg-header: rgba(22, 27, 34, 0.4);
        --border-color: rgba(0, 255, 255, 0.25);
        --border-glow: rgba(0, 255, 255, 0.5);
        --text-primary: #e6edf3;
        --text-secondary: #8b949e;
        --text-muted: #6e7681;
        --link-color: #00ff9f;
        --accent-primary: #00ff9f;
        --accent-secondary: #ff00ff;
        --btn-bg: rgba(33, 38, 45, 0.5);
        --btn-bg-hover: rgba(48, 54, 61, 0.6);
        --btn-primary-bg: rgba(0, 170, 111, 0.8);
        --btn-primary-hover: rgba(0, 204, 136, 0.9);
        --banner-bg: rgba(13, 61, 13, 0.8);
        --banner-border: #1a5c1a;
        --banner-text: #a8e6a8;
        --glass-bg: rgba(255, 255, 255, 0.05);
        --glass-border: rgba(255, 255, 255, 0.15);
        --shadow-glow: 0 0 25px rgba(0, 255, 255, 0.2);
      }

      [data-theme="light"] {
        /* Light theme (Koshien / Summer Baseball) */
        --bg-image: url('/bg-koshien.svg');
        --bg-overlay: rgba(240, 247, 230, 0.4);
        --bg-card: rgba(255, 255, 255, 0.5);
        --bg-header: rgba(255, 255, 255, 0.4);
        --border-color: rgba(0, 100, 0, 0.2);
        --border-glow: rgba(0, 100, 0, 0.4);
        --text-primary: #1a3d0c;
        --text-secondary: #4a6741;
        --text-muted: #6b8f5e;
        --link-color: #16a34a;
        --accent-primary: #16a34a;
        --accent-secondary: #dc2626;
        --btn-bg: rgba(255, 255, 255, 0.5);
        --btn-bg-hover: rgba(255, 255, 255, 0.7);
        --btn-primary-bg: rgba(22, 163, 74, 0.8);
        --btn-primary-hover: rgba(21, 128, 61, 0.9);
        --banner-bg: rgba(74, 124, 58, 0.6);
        --banner-border: #5a9a42;
        --banner-text: #ffffff;
        --glass-bg: rgba(255, 255, 255, 0.5);
        --glass-border: rgba(0, 0, 0, 0.1);
        --shadow-glow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
        color: var(--text-primary);
        min-height: 100vh;
        line-height: 1.5;
        overflow-x: hidden;
      }
      /* Fixed background image layer */
      body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-image: var(--bg-image);
        background-size: cover;
        background-position: center;
        z-index: -2;
        pointer-events: none;
      }
      /* Fixed overlay layer */
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: var(--bg-overlay);
        z-index: -1;
        pointer-events: none;
      }
      a {
        color: var(--link-color);
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      /* Button styling */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 5px 16px;
        font-size: 14px;
        font-weight: 500;
        line-height: 20px;
        border-radius: 6px;
        border: 1px solid var(--border-color);
        background-color: var(--btn-bg);
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.2s;
        backdrop-filter: blur(8px);
      }
      .btn:hover {
        background-color: var(--btn-bg-hover);
        border-color: var(--border-glow);
        text-decoration: none;
        box-shadow: var(--shadow-glow);
      }
      .btn-primary {
        background-color: var(--btn-primary-bg);
        border-color: transparent;
        color: #ffffff;
      }
      .btn-primary:hover {
        background-color: var(--btn-primary-hover);
      }
      /* Card styling */
      .card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 16px;
        backdrop-filter: blur(12px);
        box-shadow: var(--shadow-glow);
      }
      /* Icon button */
      .icon-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.2s;
        backdrop-filter: blur(8px);
        text-decoration: none;
      }
      .icon-btn:hover {
        background: var(--btn-bg-hover);
        border-color: var(--border-glow);
        box-shadow: var(--shadow-glow);
        text-decoration: none;
      }
      /* Back to top button */
      #back-to-top {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 44px;
        height: 44px;
        z-index: 1000;
        display: none;
        border-radius: 50%;
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        cursor: pointer;
        backdrop-filter: blur(12px);
        box-shadow: var(--shadow-glow);
        transition: all 0.2s;
      }
      #back-to-top:hover {
        background: var(--btn-bg-hover);
        border-color: var(--border-glow);
        transform: translateY(-2px);
      }
      /* Theme toggle button */
      .theme-toggle {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
        backdrop-filter: blur(8px);
        outline: none;
      }
      .theme-toggle:hover {
        border-color: var(--border-glow);
        box-shadow: var(--shadow-glow);
        transform: rotate(15deg);
      }
      .theme-toggle:focus {
        outline: none;
      }
      .theme-toggle svg {
        width: 20px;
        height: 20px;
        color: var(--text-primary);
      }
      /* Hide icons based on theme */
      [data-theme="dark"] .icon-sun { display: none; }
      [data-theme="dark"] .icon-moon { display: inline; }
      [data-theme="light"] .icon-sun { display: inline; }
      [data-theme="light"] .icon-moon { display: none; }
    </style>
  </head>
  <body>
    <!-- Baseball-themed encouragement banner -->
    <div style="background: var(--banner-bg); padding: 8px 16px; text-align: center; border-bottom: 3px solid var(--banner-border); backdrop-filter: blur(12px);">
      <span style="color: var(--banner-text); font-size: 14px; font-weight: 500;">
        {randomMessage}
      </span>
    </div>

    <!-- Header -->
    <header style="background: var(--bg-header); padding: 8px 16px; border-bottom: 1px solid var(--border-color); backdrop-filter: blur(12px);">
      <nav style="display: flex; gap: 16px; align-items: center; max-width: 1280px; margin: 0 auto;">
        <a href="/" style="display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: 600; color: var(--text-primary);">
          <i class="fa-solid fa-baseball" style="font-size: 20px;"></i>
          open-sen
        </a>
        <a href="/about" style="font-size: 12px; color: var(--text-muted);">About</a>
        <div style="margin-left: auto; display: flex; gap: 8px; align-items: center;">
          <!-- Theme toggle button -->
          <button class="theme-toggle" id="theme-toggle" title="テーマ切り替え">
            <i class="icon-sun fa-solid fa-sun"></i>
            <i class="icon-moon fa-solid fa-moon"></i>
          </button>
          {isLoggedIn ? (
            <>
              <a href="/projects/new" class="icon-btn" title="新規プロジェクト">
                <i class="fa-solid fa-plus"></i>
              </a>
              <a href="/auth/logout" class="icon-btn" title="サインアウト">
                <i class="fa-solid fa-right-from-bracket"></i>
              </a>
            </>
          ) : (
            <a href="/auth/login" class="icon-btn" title="サインイン">
              <i class="fa-solid fa-right-to-bracket"></i>
            </a>
          )}
        </div>
      </nav>
    </header>

    <main style="padding: 8px;">
      <slot />
    </main>

    <!-- Back to top button -->
    <button id="back-to-top" title="トップへ戻る">
      <i class="fa-solid fa-chevron-up"></i>
    </button>

    <!-- Theme toggle script -->
    <script is:inline>
      document.getElementById('theme-toggle').addEventListener('click', function() {
        const html = document.documentElement;
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      });

      // Back to top button
      const backToTopBtn = document.getElementById('back-to-top');
      window.addEventListener('scroll', function() {
        if (window.scrollY > 300) {
          backToTopBtn.style.display = 'flex';
        } else {
          backToTopBtn.style.display = 'none';
        }
      });
      backToTopBtn.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    </script>
  </body>
</html>
